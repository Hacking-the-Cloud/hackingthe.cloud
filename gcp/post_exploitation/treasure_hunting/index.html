<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The following sections detail tactics to view and exfiltrate data from various Google services.."><link href=https://hackingthe.cloud/gcp/post_exploitation/treasure_hunting/ rel=canonical><link href=../lateral-movement/ rel=prev><link href=../../tools/gcloud/ rel=next><link rel=alternate type=application/rss+xml title="RSS feed" href=../../../feed_rss_created.xml><link rel=alternate type=application/rss+xml title="RSS feed of updated content" href=../../../feed_rss_updated.xml><link rel=icon href=../../../images/logo.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.3+insiders-4.48.0"><title>Treasure hunting - Hacking The Cloud</title><link rel=stylesheet href=../../../assets/stylesheets/main.67c3bdf0.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta property=og:type content=website><meta property=og:title content="Treasure hunting - Hacking The Cloud"><meta property=og:description content="The following sections detail tactics to view and exfiltrate data from various Google services.."><meta property=og:image content=https://hackingthe.cloud/assets/images/social/gcp/post_exploitation/treasure_hunting.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta content=https://hackingthe.cloud/gcp/post_exploitation/treasure_hunting/ property=og:url><meta property=twitter:card content=summary_large_image><meta property=twitter:title content="Treasure hunting - Hacking The Cloud"><meta property=twitter:description content="The following sections detail tactics to view and exfiltrate data from various Google services.."><meta property=twitter:image content=https://hackingthe.cloud/assets/images/social/gcp/post_exploitation/treasure_hunting.png> <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#accessing-databases class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> For updates follow <strong>@frichette_n</strong> on <a href=https://fosstodon.org/@frichetten/ rel=me> <span class="twemoji mastodon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg> </span> <strong>Fosstodon</strong> </a> and <a href=https://twitter.com/frichette_n> <span class="twemoji twitter"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </span> <strong>Twitter</strong> </a> </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Hacking The Cloud" class="md-header__button md-logo" aria-label="Hacking The Cloud" data-md-component=logo> <img src=../../../images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Hacking The Cloud </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Treasure hunting </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=indigo aria-label="Switch to Dark Mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to Dark Mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=red data-md-color-accent=indigo aria-label="Switch to Light Mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to Light Mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/Hacking-the-Cloud/hackingthe.cloud title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> Hacking The Cloud </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Hacking The Cloud </a> </li> <li class=md-tabs__item> <a href=../../../aws/general-knowledge/aws_organizations_defaults/ class=md-tabs__link> AWS </a> </li> <li class=md-tabs__item> <a href=../../../azure/abusing-managed-identities/ class=md-tabs__link> Azure </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../general-knowledge/client-credential-search-order/ class=md-tabs__link> GCP </a> </li> <li class=md-tabs__item> <a href=../../../terraform/terraform_ansi_escape_evasion/ class=md-tabs__link> Terraform </a> </li> <li class=md-tabs__item> <a href=../../../blog/2023_wrap-up class=md-tabs__link> Blog </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Hacking The Cloud" class="md-nav__button md-logo" aria-label="Hacking The Cloud" data-md-component=logo> <img src=../../../images/logo.png alt=logo> </a> Hacking The Cloud </label> <div class=md-nav__source> <a href=https://github.com/Hacking-the-Cloud/hackingthe.cloud title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> Hacking The Cloud </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Hacking The Cloud </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> AWS </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> General Knowledge </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> General Knowledge </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../aws/general-knowledge/aws_organizations_defaults/ class=md-nav__link> <span class=md-ellipsis> AWS Organizations Defaults & Pivoting </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/general-knowledge/connection-tracking/ class=md-nav__link> <span class=md-ellipsis> Connection Tracking </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/general-knowledge/iam-key-identifiers/ class=md-nav__link> <span class=md-ellipsis> IAM unique identifiers </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/general-knowledge/intro_metadata_service/ class=md-nav__link> <span class=md-ellipsis> Introduction to the Instance Metadata Service </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/general-knowledge/introduction_user_data/ class=md-nav__link> <span class=md-ellipsis> Introduction to User Data </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/general-knowledge/using_stolen_iam_credentials/ class=md-nav__link> <span class=md-ellipsis> Using Stolen IAM Credentials </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> Enumeration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Enumeration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../aws/enumeration/account_id_from_ec2/ class=md-nav__link> <span class=md-ellipsis> Enumerate AWS Account ID from an EC2 Instance </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/enumeration/account_id_from_s3_bucket/ class=md-nav__link> <span class=md-ellipsis> Enumerate AWS Account ID from a Public S3 Bucket </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/enumeration/brute_force_iam_permissions/ class=md-nav__link> <span class=md-ellipsis> Brute Force IAM Permissions </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/enumeration/enum_iam_user_role/ class=md-nav__link> <span class=md-ellipsis> Unauthenticated Enumeration of IAM Users and Roles </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/enumeration/enumerate_principal_arn_from_unique_id/ class=md-nav__link> <span class=md-ellipsis> Enumerate a Principal ARN from an AWS Unique Identifier </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/enumeration/get-account-id-from-keys/ class=md-nav__link> <span class=md-ellipsis> Get Account ID from AWS Access Keys </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/enumeration/loot_public_ebs_snapshots/ class=md-nav__link> <span class=md-ellipsis> Loot Public EBS Snapshots </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/enumeration/whoami/ class=md-nav__link> <span class=md-ellipsis> Whoami - Get Principal Name From Keys </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> Exploitation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../aws/exploitation/abusing-container-registry/ class=md-nav__link> <span class=md-ellipsis> Abusing Elastic Container Registry for Lateral Movement </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/exploitation/cognito_identity_pool_excessive_privileges/ class=md-nav__link> <span class=md-ellipsis> Abusing Overpermissioned AWS Cognito Identity Pools </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/exploitation/cognito_user_self_signup/ class=md-nav__link> <span class=md-ellipsis> Abusing Unintended Self-Signup in AWS Cognito </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/exploitation/ec2-metadata-ssrf/ class=md-nav__link> <span class=md-ellipsis> Steal EC2 Metadata Credentials via SSRF </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/exploitation/iam_privilege_escalation/ class=md-nav__link> <span class=md-ellipsis> AWS IAM Privilege Escalation Techniques </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/exploitation/lambda-steal-iam-credentials/ class=md-nav__link> <span class=md-ellipsis> Steal IAM Credentials and Event Data from Lambda </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/exploitation/local-priv-esc-mod-instance-att/ class=md-nav__link> <span class=md-ellipsis> Local Privilege Escalation: User Data </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/exploitation/local-priv-esc-user-data-s3/ class=md-nav__link> <span class=md-ellipsis> Local Privilege Escalation: User Data 2 </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/exploitation/orphaned_cloudfront_or_dns_takeover_via_s3/ class=md-nav__link> <span class=md-ellipsis> DNS and CloudFront Domain Takeover via Deleted S3 Buckets </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/exploitation/route53_modification_privilege_escalation/ class=md-nav__link> <span class=md-ellipsis> AWS API Call Hijacking via ACM-PCA </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/exploitation/s3-bucket-replication-exfiltration/ class=md-nav__link> <span class=md-ellipsis> Exfiltrating S3 Data with Bucket Replication Policies </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/exploitation/s3_server_access_logs/ class=md-nav__link> <span class=md-ellipsis> Data Exfiltration through S3 Server Access Logs </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/exploitation/s3_streaming_copy/ class=md-nav__link> <span class=md-ellipsis> S3 Streaming Copy </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_14> <div class="md-nav__link md-nav__container"> <a href=../../../aws/exploitation/Misconfigured_Resource-Based_Policies/ class="md-nav__link "> <span class=md-ellipsis> Misconfigured Resource Based Policies </span> </a> <label class="md-nav__link " for=__nav_2_3_14 id=__nav_2_3_14_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_3_14_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3_14> <span class="md-nav__icon md-icon"></span> Misconfigured Resource Based Policies </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../aws/exploitation/Misconfigured_Resource-Based_Policies/misconfigured_ecr_resource_policy/ class=md-nav__link> <span class=md-ellipsis> Abusing Misconfigured ECR Resource Policies </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> Avoid Detection </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Avoid Detection </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../aws/avoiding-detection/guardduty-pentest/ class=md-nav__link> <span class=md-ellipsis> Bypass GuardDuty Pentest Findings </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/avoiding-detection/guardduty-tor-client/ class=md-nav__link> <span class=md-ellipsis> Bypass GuardDuty Tor Client Findings </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/avoiding-detection/modify-guardduty-config/ class=md-nav__link> <span class=md-ellipsis> Modify GuardDuty Configuration </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/avoiding-detection/steal-keys-undetected/ class=md-nav__link> <span class=md-ellipsis> Bypass Credential Exfiltration Detection </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> <span class=md-ellipsis> Post Exploitation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> Post Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../aws/post_exploitation/create_a_console_session_from_iam_credentials/ class=md-nav__link> <span class=md-ellipsis> Create a Console Session from IAM Credentials </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/post_exploitation/download_tools_and_exfiltrate_data_with_aws_cli/ class=md-nav__link> <span class=md-ellipsis> Download Tools and Exfiltrate Data with the AWS CLI </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/post_exploitation/get_iam_creds_from_console_session/ class=md-nav__link> <span class=md-ellipsis> Get IAM Credentials from a Console Session </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/post_exploitation/iam_persistence/ class=md-nav__link> <span class=md-ellipsis> AWS IAM Persistence Methods </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/post_exploitation/intercept_ssm_communications/ class=md-nav__link> <span class=md-ellipsis> Intercept SSM Communications </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/post_exploitation/lambda_persistence/ class=md-nav__link> <span class=md-ellipsis> Lambda Persistence </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/post_exploitation/role-chain-juggling/ class=md-nav__link> <span class=md-ellipsis> Role Chain Juggling </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/post_exploitation/run_shell_commands_on_ec2/ class=md-nav__link> <span class=md-ellipsis> Run Shell Commands on EC2 with Send Command or Session Manager </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/post_exploitation/s3_acl_persistence/ class=md-nav__link> <span class=md-ellipsis> S3 File ACL Persistence </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/post_exploitation/survive_access_key_deletion_with_sts_getfederationtoken/ class=md-nav__link> <span class=md-ellipsis> Survive Access Key Deletion with sts:GetFederationToken </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/post_exploitation/user_data_script_persistence/ class=md-nav__link> <span class=md-ellipsis> User Data Script Persistence </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> <span class=md-ellipsis> Deprecated </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> Deprecated </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../aws/deprecated/stealth_perm_enum/ class=md-nav__link> <span class=md-ellipsis> Enumerate Permissions without Logging to CloudTrail </span> </a> </li> <li class=md-nav__item> <a href=../../../aws/deprecated/whoami/ class=md-nav__link> <span class=md-ellipsis> Whoami - Get Principal Name From Keys </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex=0> <span class=md-ellipsis> Capture the Flag </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> Capture the Flag </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../aws/capture_the_flag/cicdont/ class=md-nav__link> <span class=md-ellipsis> CI/CDon't </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Azure </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Azure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../azure/abusing-managed-identities/ class=md-nav__link> <span class=md-ellipsis> Abusing Managed Identities </span> </a> </li> <li class=md-nav__item> <a href=../../../azure/anonymous-blob-access/ class=md-nav__link> <span class=md-ellipsis> Anonymous Blob Access </span> </a> </li> <li class=md-nav__item> <a href=../../../azure/enum_email_addresses/ class=md-nav__link> <span class=md-ellipsis> Unauthenticated Enumeration of Azure Active Directory Email Addresses </span> </a> </li> <li class=md-nav__item> <a href=../../../azure/soft-deleted-blobs/ class=md-nav__link> <span class=md-ellipsis> Soft Deleted Blobs </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> GCP </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> GCP </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> General Knowledge </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> General Knowledge </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../general-knowledge/client-credential-search-order/ class=md-nav__link> <span class=md-ellipsis> Client Credential Search Order </span> </a> </li> <li class=md-nav__item> <a href=../../general-knowledge/default-account-names/ class=md-nav__link> <span class=md-ellipsis> Default Account Information </span> </a> </li> <li class=md-nav__item> <a href=../../general-knowledge/gcp-buckets/ class=md-nav__link> <span class=md-ellipsis> Hunting GCP Buckets </span> </a> </li> <li class=md-nav__item> <a href=../../general-knowledge/metadata_in_google_cloud_instances/ class=md-nav__link> <span class=md-ellipsis> Metadata in Google Cloud Instances </span> </a> </li> <li class=md-nav__item> <a href=../../general-knowledge/security-and-constraints/ class=md-nav__link> <span class=md-ellipsis> Security and Constraints </span> </a> </li> <li class=md-nav__item> <a href=../../general-knowledge/security-concepts/ class=md-nav__link> <span class=md-ellipsis> Security Concepts </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Enumeration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Enumeration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../enumeration/enum_email_addresses/ class=md-nav__link> <span class=md-ellipsis> Unauthenticated Enumeration of Google Workspace Email Addresses </span> </a> </li> <li class=md-nav__item> <a href=../../enumeration/enumerate_service_account_permissions/ class=md-nav__link> <span class=md-ellipsis> Enumerate Service Account Permissions </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> Exploitation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../exploitation/gcp-metadata-ssrf/ class=md-nav__link> <span class=md-ellipsis> Steal an OAuth Token via SSRF </span> </a> </li> <li class=md-nav__item> <a href=../../exploitation/gcp-priv-esc/ class=md-nav__link> <span class=md-ellipsis> GCP Privilege Escalation </span> </a> </li> <li class=md-nav__item> <a href=../../exploitation/gcp_iam_privilege_escalation/ class=md-nav__link> <span class=md-ellipsis> Privilege Escalation in Google Cloud Platform </span> </a> </li> <li class=md-nav__item> <a href=../../exploitation/local-priv-esc-metadata/ class=md-nav__link> <span class=md-ellipsis> Local Privilege Escalation: Modifying the Metadata </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4 checked> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> Post Exploitation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Post Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lateral-movement/ class=md-nav__link> <span class=md-ellipsis> Lateral Movement </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Treasure hunting </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Treasure hunting </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#accessing-databases class=md-nav__link> <span class=md-ellipsis> Accessing databases </span> </a> </li> <li class=md-nav__item> <a href=#enumerating-storage-buckets class=md-nav__link> <span class=md-ellipsis> Enumerating storage buckets </span> </a> </li> <li class=md-nav__item> <a href=#decrypting-secrets-with-crypto-keys class=md-nav__link> <span class=md-ellipsis> Decrypting secrets with crypto keys </span> </a> </li> <li class=md-nav__item> <a href=#querying-custom-metadata class=md-nav__link> <span class=md-ellipsis> Querying custom metadata </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-serial-console-logs class=md-nav__link> <span class=md-ellipsis> Reviewing serial console logs </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-custom-images class=md-nav__link> <span class=md-ellipsis> Reviewing custom images </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-custom-instance-templates class=md-nav__link> <span class=md-ellipsis> Reviewing Custom Instance Templates </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-stackdriver-logging class=md-nav__link> <span class=md-ellipsis> Reviewing Stackdriver logging </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-cloud-functions class=md-nav__link> <span class=md-ellipsis> Reviewing cloud functions </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-app-engine-configurations class=md-nav__link> <span class=md-ellipsis> Reviewing app engine configurations </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-cloud-run-configurations class=md-nav__link> <span class=md-ellipsis> Reviewing cloud run configurations </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-ai-platform-configurations class=md-nav__link> <span class=md-ellipsis> Reviewing AI platform configurations </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-cloud-pubsub class=md-nav__link> <span class=md-ellipsis> Reviewing cloud pub/sub </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-cloud-git-repositories class=md-nav__link> <span class=md-ellipsis> Reviewing cloud Git repositories </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-cloud-filestore-instances class=md-nav__link> <span class=md-ellipsis> Reviewing cloud filestore instances </span> </a> </li> <li class=md-nav__item> <a href=#taking-a-crack-at-kubernetes class=md-nav__link> <span class=md-ellipsis> Taking a crack at Kubernetes </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-secrets-management class=md-nav__link> <span class=md-ellipsis> Reviewing secrets management </span> </a> </li> <li class=md-nav__item> <a href=#searching-the-local-system-for-secrets class=md-nav__link> <span class=md-ellipsis> Searching the local system for secrets </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> Tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tools/gcloud/ class=md-nav__link> <span class=md-ellipsis> Google Cloud CLI </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> <span class=md-ellipsis> Capture the Flag </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> Capture the Flag </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../capture_the_flag/gcp-goat/ class=md-nav__link> <span class=md-ellipsis> GCP Goat </span> </a> </li> <li class=md-nav__item> <a href=../../capture_the_flag/thunder_ctf/ class=md-nav__link> <span class=md-ellipsis> Thunder CTF </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Terraform </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Terraform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../terraform/terraform_ansi_escape_evasion/ class=md-nav__link> <span class=md-ellipsis> Terraform ANSI Escape </span> </a> </li> <li class=md-nav__item> <a href=../../../terraform/terraform_enterprise_metadata_service/ class=md-nav__link> <span class=md-ellipsis> Terraform Enterprise: Attack the Metadata Service </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../blog/2023_wrap-up class=md-nav__link> <span class=md-ellipsis> 2023 Wrap-up </span> </a> </li> <li class=md-nav__item> <a href=../../../blog/2022_wrap-up class=md-nav__link> <span class=md-ellipsis> 2022 Wrap-up </span> </a> </li> <li class=md-nav__item> <a href=../../../blog/v2_new_look class=md-nav__link> <span class=md-ellipsis> Hacking The Cloud v2: New Look </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#accessing-databases class=md-nav__link> <span class=md-ellipsis> Accessing databases </span> </a> </li> <li class=md-nav__item> <a href=#enumerating-storage-buckets class=md-nav__link> <span class=md-ellipsis> Enumerating storage buckets </span> </a> </li> <li class=md-nav__item> <a href=#decrypting-secrets-with-crypto-keys class=md-nav__link> <span class=md-ellipsis> Decrypting secrets with crypto keys </span> </a> </li> <li class=md-nav__item> <a href=#querying-custom-metadata class=md-nav__link> <span class=md-ellipsis> Querying custom metadata </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-serial-console-logs class=md-nav__link> <span class=md-ellipsis> Reviewing serial console logs </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-custom-images class=md-nav__link> <span class=md-ellipsis> Reviewing custom images </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-custom-instance-templates class=md-nav__link> <span class=md-ellipsis> Reviewing Custom Instance Templates </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-stackdriver-logging class=md-nav__link> <span class=md-ellipsis> Reviewing Stackdriver logging </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-cloud-functions class=md-nav__link> <span class=md-ellipsis> Reviewing cloud functions </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-app-engine-configurations class=md-nav__link> <span class=md-ellipsis> Reviewing app engine configurations </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-cloud-run-configurations class=md-nav__link> <span class=md-ellipsis> Reviewing cloud run configurations </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-ai-platform-configurations class=md-nav__link> <span class=md-ellipsis> Reviewing AI platform configurations </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-cloud-pubsub class=md-nav__link> <span class=md-ellipsis> Reviewing cloud pub/sub </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-cloud-git-repositories class=md-nav__link> <span class=md-ellipsis> Reviewing cloud Git repositories </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-cloud-filestore-instances class=md-nav__link> <span class=md-ellipsis> Reviewing cloud filestore instances </span> </a> </li> <li class=md-nav__item> <a href=#taking-a-crack-at-kubernetes class=md-nav__link> <span class=md-ellipsis> Taking a crack at Kubernetes </span> </a> </li> <li class=md-nav__item> <a href=#reviewing-secrets-management class=md-nav__link> <span class=md-ellipsis> Reviewing secrets management </span> </a> </li> <li class=md-nav__item> <a href=#searching-the-local-system-for-secrets class=md-nav__link> <span class=md-ellipsis> Searching the local system for secrets </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <p>Article by Chris Moberly</p> <a href=https://github.com/Hacking-the-Cloud/hackingthe.cloud/edit/main/content/gcp/post_exploitation/treasure_hunting.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <h1>Treasure hunting</h1> <p>Extracted from the GitLab blog post "<a href=https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/ >Tutorial on privilege escalation and post exploitation tactics in Google Cloud Platform environments</a>" by <a href=https://about.gitlab.com/company/team/#cmoberly>Chris Moberly</a></p> <hr> <p>As hackers, we want a root shell. Just because. But in the real world, what matters is acquiring digital assets - not escalating privileges. While a root shell may help us get there, it's not always required. The following sections detail tactics to view and exfiltrate data from various Google services.</p> <p>If you have been unable to achieve any type of privilege escalation thus far, it is quite likely that working through the following sections will help you uncover secrets that can be used again in earlier steps, finally giving you that sweet root shell you so desire.</p> <h2 id=accessing-databases>Accessing databases<a class=headerlink href=#accessing-databases title="Permanent link">&para;</a></h2> <p>Most great breaches involve a database of one type or another. You should follow traditional methods inside your compromised instance to enumerate, access, and exfiltrate data from any that you encounter.</p> <p>In addition to the traditional stuff, though, Google has <a href=https://cloud.google.com/products/databases/ >a handful of database technologies</a> that you may have access to via the default service account or another set of credentials you have compromised thus far.</p> <p>If you've granted yourself web console access, that may be the easiest way to explore. Details on working with every database type in GCP would require another long blog post, but here are some <code>gcloud</code> documentation areas you might find useful:</p> <ul> <li><a href=https://cloud.google.com/sdk/gcloud/reference/sql/ >Cloud SQL</a></li> <li><a href=https://cloud.google.com/sdk/gcloud/reference/spanner/ >Cloud Spanner</a></li> <li><a href=https://cloud.google.com/sdk/gcloud/reference/bigtable/ >Cloud Bigtable</a></li> <li><a href=https://cloud.google.com/sdk/gcloud/reference/firestore/ >Cloud Firestore</a></li> <li><a href=https://cloud.google.com/sdk/gcloud/reference/firebase/ >Firebase</a></li> </ul> <p>You may get lucky and discover ready-to-go backups of your target database when <a href=#enumerating-storage-buckets>enumerating storage buckets</a>. Otherwise, each database type provides various <code>gcloud</code> commands to export the data. This typically involves writing the database to a cloud storage bucket first, which you can then download. It may be best to use an existing bucket you already have access to, but you can also create your own if you want.</p> <p>As an example, you can follow <a href=https://cloud.google.com/sql/docs/mysql/import-export/exporting>Google's documentation</a> to exfiltrate a Cloud SQL database.</p> <p>The following commands may be useful to help you identify database targets across the project.</p> <div class=highlight><pre><span></span><code># Cloud SQL
$ gcloud sql instances list
$ gcloud sql databases list --instance [INSTANCE]

# Cloud Spanner
$ gcloud spanner instances list
$ gcloud spanner databases list --instance [INSTANCE]

# Cloud Bigtable
$ gcloud bigtable instances list
</code></pre></div> <h2 id=enumerating-storage-buckets>Enumerating storage buckets<a class=headerlink href=#enumerating-storage-buckets title="Permanent link">&para;</a></h2> <p>We all love stumbling across open storage buckets, but finding them usually requires brute forcing massive wordlists or just getting lucky and tripping over them in source code. As shown in the "access scopes" section above, default configurations permit read access to storage. This means that your shell can now enumerate ALL storage buckets in the project, including listing and accessing the contents inside.</p> <p>This can be a MAJOR vector for privilege escalation, as those buckets can contain secrets.</p> <p>The following commands will help you explore this vector:</p> <div class=highlight><pre><span></span><code># List all storage buckets in project
$ gsutil ls

# Get detailed info on all buckets in project
$ gsutil ls -L

# List contents of a specific bucket (recursive, so careful!)
$ gsutil ls -r gs://bucket-name/

# Cat the context of a file without copying it locally
$ gsutil cat gs://bucket-name/folder/object

# Copy an object from the bucket to your local storage for review
$ gsutil cp gs://bucket-name/folder/object ~/
</code></pre></div> <p>If your initial <code>gsutil ls</code> command generates a permission denied error, you may still have access to buckets - you just need to know their names first. Hopefully you've explored enough to get a feel for naming conventions in the project, which will assist in brute-forcing.</p> <p>You can use a simple bash loop like the following to work through a wordlist. You should create a targeted wordlist based on the environment, as this command will essentially look for buckets from any customer.</p> <div class=highlight><pre><span></span><code>$ for i in $(cat wordlist.txt); do gsutil ls -r gs://&quot;$i&quot;; done
</code></pre></div> <h2 id=decrypting-secrets-with-crypto-keys>Decrypting secrets with crypto keys<a class=headerlink href=#decrypting-secrets-with-crypto-keys title="Permanent link">&para;</a></h2> <p><a href=https://cloud.google.com/kms/docs/ >Cloud Key Management Service</a> is a repository for storing cryptographic keys, such as those used to encrypt and decrypt sensitive files. Individual keys are stored in key rings, and granular permissions can be applied at either level. An [API is available] for key management and easy encryption/decryption of objects stored in Google storage.</p> <p>If you're lucky, the service account assigned to your breached instance has access to some keys. Perhaps you've even noticed some encrypted files while rummaging through buckets.</p> <p>It's possible that you have access to decryption keys but don't have the permissions required to figure out what those keys are. If you encounter encrypted files, it is worthwhile trying to find documentation, scripts, or bash history somewhere to figure out the required arguments for the command below.</p> <p>Assuming you do have permission to enumerate, the process looks like this. Below we're assuming that all keys were made available globally, but it's possible there are keys pinned to specific regions only.</p> <div class=highlight><pre><span></span><code># List the global keyrings available
$ gcloud kms keyrings list --location global

# List the keys inside a keyring
$ gcloud kms keys list --keyring [KEYRING NAME] --location global

# Decrypt a file using one of your keys
$ gcloud kms decrypt --ciphertext-file=[INFILE] \
    --plaintext-file=[OUTFILE] \
    --key [KEY] \
    --keyring [KEYRING] \
    --location global
</code></pre></div> <h2 id=querying-custom-metadata>Querying custom metadata<a class=headerlink href=#querying-custom-metadata title="Permanent link">&para;</a></h2> <p>Administrators can add <a href=https://cloud.google.com/compute/docs/storing-retrieving-metadata#custom>custom metadata</a> at the instance and project level. This is simply a way to pass arbitrary key/value pairs into an instance, and is commonly used for environment variables and startup/shutdown scripts.</p> <p>If you followed the steps above, you've already queried the metadata endpoint for all available information. This would have included any custom metadata. You can also use the following commands to view it on its own:</p> <div class=highlight><pre><span></span><code># view project metadata
$ curl &quot;http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&amp;alt=text&quot; \
    -H &quot;Metadata-Flavor: Google&quot;

# view instance metadata
$ curl &quot;http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&amp;alt=text&quot; \
    -H &quot;Metadata-Flavor: Google&quot;
</code></pre></div> <p>Maybe you'll get lucky and find something juicy.</p> <h2 id=reviewing-serial-console-logs>Reviewing serial console logs<a class=headerlink href=#reviewing-serial-console-logs title="Permanent link">&para;</a></h2> <p>By default, compute instances write output from the OS and BIOS to serial ports. Google provides <a href=https://cloud.google.com/compute/docs/instances/viewing-serial-port-output>a couple of ways</a> to view these log files. The first is via the compute API and can be executed even via the restrictive "Compute: Read Only" access scope.</p> <p>Serial console logs may expose sensitive information from the system logs, which a low-privilege shell on a compute instance may not have access to view. However, you might be able to bypass this restriction if the instance is bound to a service account with the appropriate rights. If these rights are granted project-wide, you'll be able to view the logs on all compute instances, possibly providing information required to move laterally to other instances.</p> <p>You can use the following <a href=https://cloud.google.com/sdk/gcloud/reference/compute/instances/get-serial-port-output>gcloud command</a> to query the serial port logs:</p> <div class=highlight><pre><span></span><code>gcloud compute instances get-serial-port-output instance-name \
  --port port \
  --start start \
  --zone zone
</code></pre></div> <p>In addition, serial port logs may be stored to Cloud Logging, if <a href=https://cloud.google.com/compute/docs/instances/viewing-serial-port-output#enable-stackdriver>enabled by an administrator</a>. If you've gained access to read permissions for logging, this may be an alternative method to view this information. Read the "<a href=#reviewing-stackdriver-logging>Reviewing Stackdriver logging</a>" section for more info.</p> <h2 id=reviewing-custom-images>Reviewing custom images<a class=headerlink href=#reviewing-custom-images title="Permanent link">&para;</a></h2> <p>Custom compute images may contain sensitive details or other vulnerable configurations that you can exploit. You can query the list of non-standard images in a project with the following command:</p> <div class=highlight><pre><span></span><code>$ gcloud compute images list --no-standard-images
</code></pre></div> <p>You can then <a href=https://cloud.google.com/sdk/gcloud/reference/compute/images/export>export</a> the virtual disks from any image in multiple formats. The following command would export the image <code>test-image</code> in qcow2 format, allowing you to download the file and build a VM locally for further investigation:</p> <div class=highlight><pre><span></span><code>$ gcloud compute images export --image test-image \
    --export-format qcow2 --destination-uri [BUCKET]
</code></pre></div> <h2 id=reviewing-custom-instance-templates>Reviewing Custom Instance Templates<a class=headerlink href=#reviewing-custom-instance-templates title="Permanent link">&para;</a></h2> <p>An <a href=https://cloud.google.com/compute/docs/instance-templates/ >instance template</a> defines instance properties to help deploy consistent configurations. These may contain the same types of sensitive data as a running instance's custom metadata. You can use the following commands to investigate:</p> <div class=highlight><pre><span></span><code># List the available templates
$ gcloud compute instance-templates list

# Get the details of a specific template
$ gcloud compute instance-templates describe [TEMPLATE NAME]
</code></pre></div> <h2 id=reviewing-stackdriver-logging>Reviewing Stackdriver logging<a class=headerlink href=#reviewing-stackdriver-logging title="Permanent link">&para;</a></h2> <p><a href=https://cloud.google.com/stackdriver/ >Stackdriver</a> is Google's general-purpose infrastructure logging suite. There is a LOT of data that could be captured here. This can include syslog-like capabilities that report individual commands run inside Compute Instances, HTTP requests sent to load balancers or App Engine applications, network packet metadata for VPC communications, and more.</p> <p>The service account for a Compute Instance only needs WRITE access to enable logging on instance actions, but an administrator may mistakenly grant the service account both READ and WRITE access. If this is the case, you can explore logs for sensitive data.</p> <p><a href=https://cloud.google.com/sdk/gcloud/reference/logging/ >gcloud logging</a> provides tools to get this done. First, you'll want to see what types of logs are available in your current project. The following shows the command and output from a test project:</p> <div class=highlight><pre><span></span><code>$ gcloud logging logs list
NAME
projects/REDACTED/logs/OSConfigAgent
projects/REDACTED/logs/cloudaudit.googleapis.com%2Factivity
projects/REDACTED/logs/cloudaudit.googleapis.com%2Fsystem_event
projects/REDACTED/logs/bash.history
projects/REDACTED/logs/compute.googleapis.com
projects/REDACTED/logs/compute.googleapis.com%2Factivity_log
</code></pre></div> <p>The output you see will be all of the log folders in the project that contain entries. So, if you see it - something is there. Folders are generated automatically by the standard Google APIs but can also be created by any application with IAM permissions to write to logs.</p> <p>You may notice an interesting custom name in the list above (unfortunately, <code>bash.history</code> is not a default). While you should inspect all log entries, definitely take the time to manually review and understand if something is worth looking at more closely.</p> <p>You can view the logs for an individual item as follows.</p> <div class=highlight><pre><span></span><code>$ gcloud logging read [FOLDER]
</code></pre></div> <p>Omitting the folder name will just start dumping all the logs. You might want to add a <code>--LIMIT</code> flag if you do this.</p> <p>If a service account has permissions to write to log file (even the most restricted generally do), you can write arbitrary data to existing log folders and/or create new log folders and write data there as follows.</p> <div class=highlight><pre><span></span><code>$ gcloud logging write [FOLDER] [MESSAGE]
</code></pre></div> <p>Advanced write functionality (payload type, severity, etc) can be found in the <a href=https://cloud.google.com/sdk/gcloud/reference/logging/write>gcloud logging write documentation</a>.</p> <p>Extra-crafty attackers can get creative with this. Writing log entries may be an interesting way to distract the Blue Team folks, hide your actions, or even phish via detection/response events.</p> <h2 id=reviewing-cloud-functions>Reviewing cloud functions<a class=headerlink href=#reviewing-cloud-functions title="Permanent link">&para;</a></h2> <p>Google <a href=https://cloud.google.com/functions/ >Cloud Functions</a> allow you to host code that is executed when an event is triggered, without the requirement to manage a host operating system. These functions can also store environment variables to be used by the code. And what do people use environment variables for? Secrets!</p> <p>You can see if any cloud functions are available to you by running:</p> <div class=highlight><pre><span></span><code>$ gcloud functions list
</code></pre></div> <p>You can then query an individual function for its configuration, which would include any defined environment variables:</p> <div class=highlight><pre><span></span><code>$ gcloud functions describe [FUNCTION NAME]
</code></pre></div> <p>The output log of previous runs may be useful as well, which you get review with:</p> <div class=highlight><pre><span></span><code># You can omit the function name to view all the logs
# By default, limits to 10 lines
$ gcloud functions logs read [FUNCTION NAME] --limit [NUMBER]
</code></pre></div> <h2 id=reviewing-app-engine-configurations>Reviewing app engine configurations<a class=headerlink href=#reviewing-app-engine-configurations title="Permanent link">&para;</a></h2> <p>Google <a href=https://cloud.google.com/appengine/ >App Engine</a> is another <a href=/topics/serverless/ >"serverless"</a> offering for hosting applications, with a focus on scalability. As with Cloud Functions, there is a chance that the application will rely on secrets that are accessed at run-time via environment variables. These variables are stored in an <code>app.yaml</code> file which can be accessed as follows:</p> <div class=highlight><pre><span></span><code># First, get a list of all available versions of all services
$ gcloud app versions list

# Then, get the specific details on a given app
$ gcloud app describe [APP]
</code></pre></div> <h2 id=reviewing-cloud-run-configurations>Reviewing cloud run configurations<a class=headerlink href=#reviewing-cloud-run-configurations title="Permanent link">&para;</a></h2> <p>Google <a href=https://cloud.google.com/run>Cloud Run</a> is... yep, another "serverless" offering! You'll want to also look here for environment variables, but this one introduces a new potential exploitation vector. Basically, Cloud Run creates a small web server, running on port 8080, that sits around waiting for an HTTP GET request. When the request is received, a job is executed and the job log is output via an HTTP response.</p> <p>When a Cloud Run service is created, the administrator has the option to use IAM permissions to control who can start that job. They can also configure it to be completely unauthenticated, meaning that anyone with the URL can trigger the job and view the output.</p> <p>Jobs are run in containers via Kubernetes, in clusters that are fully managed by Google or partially managed via <a href=https://cloud.google.com/anthos>Anthos</a>.</p> <p>Tread carefully here. We don't know what these jobs do, and triggering one without understanding that may cause heartache for your production team.</p> <p>The following commands will help you explore this vector.</p> <div class=highlight><pre><span></span><code># First get a list of services across the available platforms
$ gcloud run services list --platform=managed
$ gcloud run services list --platform=gke

# To learn more, export as JSON and investigate what the services do
$ gcloud run services list --platform=managed --format=json
$ gcloud run services list --platform=gke --format=json

# Attempt to trigger a job unauthenticated
$ curl [URL]

# Attempt to trigger a job with your current gcloud authorization
$ curl -H \
    &quot;Authorization: Bearer $(gcloud auth print-identity-token)&quot; \
    [URL]
</code></pre></div> <h2 id=reviewing-ai-platform-configurations>Reviewing AI platform configurations<a class=headerlink href=#reviewing-ai-platform-configurations title="Permanent link">&para;</a></h2> <p>Google <a href=https://cloud.google.com/ai-platform/ >AI Platform</a> is (yep, another) "serverless" offering for machine learning projects.</p> <p>There are a few areas here you can look for interesting information - models and jobs. Try the following commands.</p> <div class=highlight><pre><span></span><code>$ gcloud ai-platform models list --format=json
$ gcloud ai-platform jobs list --format=json
</code></pre></div> <h2 id=reviewing-cloud-pubsub>Reviewing cloud pub/sub<a class=headerlink href=#reviewing-cloud-pubsub title="Permanent link">&para;</a></h2> <p>Google <a href=https://cloud.google.com/pubsub/ >Cloud Pub/Sub</a> is a service that allows independent applications to send messages back and forth.</p> <p>Pub/Sub consists of the following <a href=https://cloud.google.com/pubsub/docs/overview#data_model>core concepts</a>:</p> <ul> <li>Topic: A logical grouping for messages</li> <li>Subscriptions: This is where applications access a stream of messages related to a topic. Some Google services can receive these via a push notification, while custom services can subscribe using a pull.</li> <li>Messages: Some data and optionally metadata.</li> </ul> <p>There is a lot of potential for attackers here in terms of affecting these messages and, in turn, the behaviour of the applications that rely on them. That's a topic for another day - this section focuses only on mostly-passive exploration of these streams using <a href=https://cloud.google.com/sdk/gcloud/reference/pubsub/ >gcloud pubsub</a>.</p> <p>The following commands should help you explore.</p> <div class=highlight><pre><span></span><code># Get a list of topics in the project
$ gcloud pubsub topics list

# Get a list of subscriptions across all topics
$ gcloud pubsub subscriptions list --format=json
</code></pre></div> <p>The <a href=https://cloud.google.com/sdk/gcloud/reference/pubsub/subscriptions/pull>pull</a> command will allow us to mimic a valid application, asking for messages that have not yet been acknowledged as delivered. You can mimic this behaviour with the following command, which will NOT send an ACK back and should therefore not impact other applications depending on the subscription:</p> <div class=highlight><pre><span></span><code>$ gcloud pubsub subscriptions pull [SUBSCRIPTION NAME]
</code></pre></div> <p>A savvy attacker might realize that they could intentionally ACK messages to ensure they are never received by the valid applications. This could be helpful to evade some detection implementations.</p> <p>However, you may have better results <a href=https://cloud.google.com/pubsub/docs/replay-overview>asking for a larger set of data</a>, including older messages. This has some prerequisites and could impact applications, so make sure you really know what you're doing.</p> <h2 id=reviewing-cloud-git-repositories>Reviewing cloud Git repositories<a class=headerlink href=#reviewing-cloud-git-repositories title="Permanent link">&para;</a></h2> <p>Google's <a href=https://cloud.google.com/source-repositories/ >Cloud Source Repositories</a> are Git designed to be private storage for source code. You might find useful secrets here, or use the source to discover vulnerabilities in other applications.</p> <p>You can explore the available repositories with the following commands:</p> <div class=highlight><pre><span></span><code># enumerate what&#39;s available
$ gcloud source repos list

# clone a repo locally
$ gcloud source repos clone [REPO NAME]
</code></pre></div> <h2 id=reviewing-cloud-filestore-instances>Reviewing cloud filestore instances<a class=headerlink href=#reviewing-cloud-filestore-instances title="Permanent link">&para;</a></h2> <p>Google <a href=https://cloud.google.com/filestore/ >Cloud Filestore</a> is NAS for Compute Instances and Kubernetes Engine instances. You can think of this like any other shared document repository - a potential source of sensitive info.</p> <p>If you find a filestore available in the project, you can mount it from within your compromised Compute Instance. Use the following command to see if any exist.</p> <div class=highlight><pre><span></span><code>$ gcloud filestore instances list --format=json
</code></pre></div> <h2 id=taking-a-crack-at-kubernetes>Taking a crack at Kubernetes<a class=headerlink href=#taking-a-crack-at-kubernetes title="Permanent link">&para;</a></h2> <p><a href=https://cloud.google.com/kubernetes-engine/ >Google Kubernetes Engine</a> is managed Kubernetes as a service.</p> <p>Kubernetes is worthy of its own tutorial, particularly if you are looking to break out of a container into the wider GCP project. We're going to keep it short and sweet for now.</p> <p>First, you can check to see if any Kubernetes clusters exist in your project.</p> <div class=highlight><pre><span></span><code>$ gcloud container clusters list
</code></pre></div> <p>If you do have a cluster, you can have <code>gcloud</code> automatically configure your <code>~/.kube/config</code> file. This file is used to authenticate you when you use <a href=https://kubernetes.io/docs/reference/kubectl/overview/ >kubectl</a>, the native CLI for interacting with K8s clusters. Try this command.</p> <div class=highlight><pre><span></span><code>$ gcloud container clusters get-credentials [CLUSTER NAME] --region [REGION]
</code></pre></div> <p>Then, take a look at the <code>~/.kube/config</code> file to see the generated credentials. This file will be used to automatically refresh access tokens based on the same identity that your active <code>gcloud</code> session is using. This of course requires the correct permissions in place.</p> <p>Once this is set up, you can try the following command to get the cluster configuration.</p> <div class=highlight><pre><span></span><code>kubectl cluster-info
</code></pre></div> <p>You can read more about <code>gcloud</code> for containers <a href=https://cloud.google.com/sdk/gcloud/reference/container/ >here</a>.</p> <h2 id=reviewing-secrets-management>Reviewing secrets management<a class=headerlink href=#reviewing-secrets-management title="Permanent link">&para;</a></h2> <p>Google <a href=https://cloud.google.com/solutions/secrets-management/ >Secrets Management</a> is a vault-like solution for storing passwords, API keys, certificates, and other sensitive data. As of this writing, it is currently in beta.</p> <p>If in use, this could be a gold mine. Give it a shot as follows:</p> <div class=highlight><pre><span></span><code># First, list the entries
$ gcloud beta secrets list

# Then, pull the clear-text of any secret
$ gcloud beta secrets versions access 1 --secret=&quot;[SECRET NAME]&quot;
</code></pre></div> <p>Note that changing a secret entry will create a new version, so it's worth changing the <code>1</code> in the command above to a <code>2</code> and so on.</p> <p>As this offering is still in beta, these commands are likely to change with time.</p> <h2 id=searching-the-local-system-for-secrets>Searching the local system for secrets<a class=headerlink href=#searching-the-local-system-for-secrets title="Permanent link">&para;</a></h2> <p>Temporary directories, history files, environment variables, shell scripts, and various world-readable files are usually a treasure trove for secrets. You probably already know all that, so here are some regexes that will come in handy when grepping for things specific to GCP.</p> <p>Each grep command is using the <code>-r</code> flag to search recursively, so first set the TARGET_DIR variable and then fire away.</p> <div class=highlight><pre><span></span><code>TARGET_DIR=&quot;/path/to/whatever&quot;

# Service account keys
grep -Pzr &quot;(?s){[^{}]*?service_account[^{}]*?private_key.*?}&quot; \
    &quot;$TARGET_DIR&quot;

# Legacy GCP creds
grep -Pzr &quot;(?s){[^{}]*?client_id[^{}]*?client_secret.*?}&quot; \
    &quot;$TARGET_DIR&quot;

# Google API keys
grep -Pr &quot;AIza[a-zA-Z0-9\\-_]{35}&quot; \
    &quot;$TARGET_DIR&quot;

# Google OAuth tokens
grep -Pr &quot;ya29\.[a-zA-Z0-9_-]{100,200}&quot; \
    &quot;$TARGET_DIR&quot;

# Generic SSH keys
grep -Pzr &quot;(?s)-----BEGIN[ A-Z]*?PRIVATE KEY[

    a-zA-Z0-9/\+=\n-]*?END[ A-Z]*?PRIVATE KEY-----&quot; \
    &quot;$TARGET_DIR&quot;

# Signed storage URLs
grep -Pir &quot;storage.googleapis.com.*?Goog-Signature=[a-f0-9]+&quot; \
    &quot;$TARGET_DIR&quot;

# Signed policy documents in HTML
grep -Pzr &#39;(?s)&lt;form action.*?googleapis.com.*?name=&quot;signature&quot; value=&quot;.*?&quot;&gt;&#39; \
    &quot;$TARGET_DIR&quot;
</code></pre></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">December 2, 2022</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 23, 2022</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Contributors> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg> </span> <span>GitHub</span> <nav> <a href=https://github.com/Frichetten class=md-author title=@Frichetten> <img src="https://avatars.githubusercontent.com/u/10386884?v=4&size=72" alt=Frichetten> </a> <a href=https://github.com/Techbrunch class=md-author title=@Techbrunch> <img src="https://avatars.githubusercontent.com/u/1835765?v=4&size=72" alt=Techbrunch> </a> </nav> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs Insiders </a> </div> <div class=md-social> <a href=https://infosec.exchange/@hackingthecloud target=_blank rel="noopener me" title=infosec.exchange class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg> </a> <a href=https://twitter.com/Frichette_n target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://www.linkedin.com/in/nick-frichette/ target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://github.com/Hacking-the-Cloud target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://hackingthe.cloud/feed_rss_created.xml target=_blank rel=noopener title=hackingthe.cloud class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M0 64c0-17.7 14.3-32 32-32 229.8 0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7 0 64zm0 352a64 64 0 1 1 128 0 64 64 0 1 1-128 0zm32-256c159.1 0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7 0-32-14.3-32-32s14.3-32 32-32z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.indexes", "content.action.edit"], "search": "../../../assets/javascripts/workers/search.1e90e0fb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.8e8db93a.min.js></script> <script src=../../../javascripts/matomo.min.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body> </html>