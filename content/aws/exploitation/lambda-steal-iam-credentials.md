---
author_name: Nick Frichette
title: Steal IAM Credentials and Event Data from Lambda
description: Leverage file read and SSRF vulnerabilities to steam IAM credentials and event data from Lambda.
hide:
  - toc
---

# Steal IAM Credentials and Event Data from Lambda

<div class="grid cards" markdown>

-   :material-alert-decagram:{ .lg .middle } __Technique seen in the wild__

    ---

    Reference: [Compromised Cloud Compute Credentials: Case Studies From the Wild](https://unit42.paloaltonetworks.com/compromised-cloud-compute-credentials/#post-125981-_kdq0vw6banab)

</div>

In Lambda, IAM credentials are passed into the function via environment variables. The benefit for the adversary is that these credentials can be leaked via file read vulnerabilities such as [XML External Entity](https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A4-XML_External_Entities_(XXE)) attacks or SSRF that allows the file protocol. This is because "[everything is a file](https://en.wikipedia.org/wiki/Everything_is_a_file)".

IAM credentials can be accessed via reading `/proc/self/environ`.

<figure markdown>
  ![Credentials](../../images/aws/exploitation/lambda-steal-iam-credentials/credentials.png){ loading=lazy }
</figure>

!!! Note
    In the event that /proc/self/environ is blocked by a WAF, check if you can read the environment variables of other processes. This can be done by reading /proc/#/environ where '#' is some number often between 1 and 20.

In addition to IAM credentials, Lambda functions also have event data that is passed to the function when it is started. This data is made available to the function via the [runtime interface](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-api.html). Unlike IAM credentials, this data is accessible over standard SSRF at `http://169.254.100.1:9001/2018-06-01/runtime/invocation/next`. Additionally the environment variable `AWS_LAMBDA_RUNTIME_API` stores the IP address and port of the runtime interface as well.

This will include information about what invoked the Lambda function and may be valuable depending on the context.

!!! Note
    Unlike IAM credentials associated with EC2 instances, there is no [GuardDuty](https://hackingthe.cloud/aws/avoiding-detection/steal-keys-undetected/) alert for stolen Lambda credentials.